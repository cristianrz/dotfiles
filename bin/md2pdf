#!/bin/bash
function convert(){
  md2html "$1" > /tmp/a.html
  file_name=${1%.*}
  wkhtmltopdf /tmp/a.html "${file_name}.pdf" &> /dev/null
  if [[ -f ${file_name}.pdf ]]; then
    printf "Created %s.pdf\n\n" "${file_name}"
  else
    echo "Error: file was not created"
    exit 1
  fi
}


if [[ $1 == "-r" ]]; then
  while true; do
    current=$(md5sum "$2")
    if [[ $current != "$reference" ]]; then
      date=$(date)
      echo "${date}: Detected a change in ${2}"
      convert "$2"
      reference=$current
      echo "Waiting for changes..."
    fi
    sleep 2s
  done
elif [[ $1 == "--help" ]]; then
  printf "
--help: show this help menu
-r: Autoconvert when changes are detected\n"
elif [[ $1 == "" ]]; then
  echo "Error: You must provide at least one argument"
  md2pdf --help
else
  convert "$1"
fi
        



